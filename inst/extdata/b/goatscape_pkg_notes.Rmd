---
title: "goatscape_pkg_notes"
author: "Bryan Milstead"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## to do
* is [goatscape_pkg_notes.rmd] in the correct directory? [inst/extdata/b]?

## Introduction

This .rmd file documents the work process for building the package [goatscape]

## installation
library("devtools")
install_github("usepa/goatscape")
library("goatscape")

## gs_census

### Data Files
* r-script used to create the package data [data-raw/create_pkg_data.r]

### geoid is the unique identifier for census blocks/block ids; not currently using it and varies by year
* The geoid is a combination of "state fips", "county fips", "tract id", and "block id".  For example: geoid == 440030208003077 corresponds to statefp == 44, countfp == 003, tractce == 020800, and blockce == 3077.

* Note: there can be differences among census years.

```{r}
# https://cran.r-project.org/web/packages/censusapi/vignettes/getting-started.html
View(censusapi::listCensusApis())
sf1_2000 <- censusapi::listCensusMetadata(name="sf1", vintage = 2000, type = "variables")
  View(sf1_2000)  # filter; concept == "Total Population"; "P001001"
  
sf3_2000 <- censusapi::listCensusMetadata(name="sf3", vintage = 2000, type = "variables")
  View(sf3_2000)  # filter; concept == "Total Population"; "P001001"

sf1_2010 <- censusapi::listCensusMetadata(name="sf1", vintage = 2010, type = "variables")
  View(sf1_2010)  # filter; concept == "Total Population"; "P0010001"  
```

### census codes

```{r codes}
# https://cran.r-project.org/web/packages/censusapi/vignettes/getting-started.html
View(censusapi::listCensusApis())
sf1_2000 <- censusapi::listCensusMetadata(name="sf1", vintage = 2000, type = "variables")
  View(sf1_2000)  # filter; concept == "Total Population"; "P001001"
  
sf3_2000 <- censusapi::listCensusMetadata(name="sf3", vintage = 2000, type = "variables")
  View(sf3_2000)  # filter; concept == "Total Population"; "P001001"

sf1_2010 <- censusapi::listCensusMetadata(name="sf1", vintage = 2010, type = "variables")
  View(sf1_2010)  # filter; concept == "Total Population"; "P0010001"  
```

* Total Population
    - name == "sf1"; vintage == 2000; vars == "P001001"
    - name == "sf3"; vintage == 2000; vars == "P001001"
    - name == "sf1"; vintage == 2010; vars == "P0010001"
    
* Use "sf1" for both years
    - [SF 1 gives exact numbers even for very small groups and areas, whereas SF 3 gives estimates for small groups and areas such as tracts and small places that are less exact. The goal of SF 3 is to identify large differences among areas or large changes over time. Estimates for small areas and small population groups often do exhibit large changes from one census to the next, so having the capability to measure them is worthwhile.](https://www.census.gov/census2000/sf3compnote.html)

* [census.gov](https://factfinder.census.gov) has a gui to get these data also.  It can be tricky to find what you want.  
* NOTE: use internet explorer; didn't work with Chrome.
* Here are the steps to dowload the census data tables:
    - [Advance Search]
    - [Show Me All]
    - [Topics] (left side bar)
    - [+ People] [+ Basic Count/Estimate] [+ Population Total] [+ Year] [select 2000/2010] [Close]
    - from here you can search for the table you want or better search [sf1] in the "refine you search results: topic or table name" at top of table list.  It will give you some choices.  Pick the right one (YEAR SF1 100% Data) then select [go] 
    - click box for [P1 Total Population YEAR SF1 100% Data]
    - select [download] and follow instructions in the popups
    
* Here are the steps to dowload the census spatial data:
    - [Advance Search]
    - [Show Me All]
    - [Geographies] (left side bar) 
    - [Map tab] center panel
    - [seach for a city near your lake] center panel
    - [more geography types] radio button right side center panel
    - click drop down arrow for "select a geographic type"
    - [Block Group] from drop down
    - Find lake and zoom in to see block groups (may need to select from drop down again)
    - use select tools to pick the block groups.
    - Important:  click [add to your selection] in the "select geographies" toolbar
    - choose [download] from toolbar (on the right?)
    - [Shapefiles] radio button [ok]
    
    
    
    - sort through center panel table and select [P1; TOTAL POPULATION; YEAR SF1 100% Data]
    
## get_nlcd
* NLCD website: http://www.mrlc.gov/index.php
* basic example: http://spatialecology.weebly.com/r-code--data/category/data-vegetation
* The National Map API: https://viewer.nationalmap.gov/help/documents/TNMAccessAPIDocumentation/TNMAccessAPIDocumentation.pdf
* feddata package being updated; good code to copy: https://github.com/ropensci/FedData/tree/master/R
* NLCD data on AWS; tiled by bbox: https://s3-us-west-2.amazonaws.com/prd-tnm/StagedProducts/NLCD/data/2011/landcover/3x3/NLCD2011_LC_N24W078.zip
* NLCD USGS: https://www.sciencebase.gov/catalog/item/5a1c31abe4b09fc93dd6381c

### message from Kyle Walker about [tigris]

Kyle Walker <notifications@github.com>
5:52 PM (17 hours ago)

to walkerke/tigris, me, Author 
I'm glad you've found the package useful! This is a limitation of how the data are provided by the Census Bureau. Block shapefiles are available by state; tigris downloads the state shapefile then subsets by county in R. As such there isn't a way to speed up the download outside of a faster internet connection. However, I'd recommend:

Using caching with options(tigris_use_cache = TRUE);
Using the simple features class with class = "sf" or options(tigris_class = "sf"); this speeds loading times signficantly (especially when paired with shapefile caching);
Identifying the blocks - or region of potential blocks - you need and saving out as a .rds file, then loading back in as needed.


```{r example}
library(raster)

#Download data
temp <- tempfile() #create a temp file

#download the data (this is a 1 TB file)
download.file("http://gisdata.usgs.gov/TDDS/DownloadFile.php?TYPE=nlcd2011&FNAME=nlcd_2011_landcover_2011_edition_2014_10_10.zip",temp)

#unzip the file
unzip(temp, exdir=here::here('temp'))

#delete the temp file
unlink(temp)

#Rasterize the data (package “raster”)
  cont_usa <- raster(here::here("temp/nlcd_2011_landcover_2011_edition_2014_10_10/nlcd_2011_landcover_2011_edition_2014_10_10.img"))

#Change the resolution of the data to decrease file size using aggregate()
  cont_usa_coarse <- aggregate(Cont_USA, fact=100, fun=max)

#Plot the NLCD data
  plot(cont_usa_coarse, main="NLCD Land Cover Types; Continental USA; full res", legend = FALSE, asp=1)
  plot(cont_usa_coarse, main="NLCD Land Cover Types; Continental USA; lower res", legend = FALSE, asp=1)
  
```




